# Phase 2 功能测试指南

**版本**: v2.0  
**日期**: 2026年2月7日  
**预计测试时间**: 30-45 分钟

---

## 📋 目录

1. [环境准备](#环境准备)
2. [启动项目](#启动项目)
3. [功能测试清单](#功能测试清单)
4. [常见问题](#常见问题)
5. [测试报告模板](#测试报告模板)

---

## 🔧 环境准备

### 1. 克隆仓库（如果还没有）

```bash
git clone https://github.com/magicy565-web/demand-os.git
cd demand-os/web
```

### 2. 安装依赖

```bash
# 使用 pnpm（推荐）
pnpm install

# 或使用 npm
npm install
```

### 3. 配置环境变量

创建 `.env.local` 文件：

```bash
cd /path/to/demand-os/web
touch .env.local
```

添加以下内容到 `.env.local`：

```env
# Directus 配置
NEXT_PUBLIC_DIRECTUS_URL=https://admin.cnsubscribe.xyz
DIRECTUS_EMAIL=magic@gmail.com
DIRECTUS_PASSWORD=wysk1214

# Nova AI 配置
NOVA_AI_API_KEY=sk-SqCEqx9Vz5sYgmXOXvjZQBaOPFjjxpfcPPEJHXmPCrLVpBXp
NOVA_AI_API_URL=https://once.novai.su/v1

# 前端配置
NEXT_PUBLIC_API_URL=http://localhost:3000
```

---

## 🚀 启动项目

### 1. 启动开发服务器

```bash
cd demand-os/web
pnpm dev
```

等待服务器启动，您应该看到：

```
✓ Ready in 3.2s
○ Local:        http://localhost:3000
○ Network:      http://192.168.x.x:3000
```

### 2. 访问演示页面

打开浏览器，访问以下任一地址：

- **Phase 2 演示页面**: http://localhost:3000/phase2-demo
- **主聊天页面**: http://localhost:3000/chat
- **主页**: http://localhost:3000

---

## ✅ 功能测试清单

### 测试 1: 对话历史记录

#### 1.1 查看对话列表

**步骤**:
1. 访问 http://localhost:3000/phase2-demo
2. 点击 "对话历史" 标签
3. 查看左侧侧边栏

**预期结果**:
- [ ] 侧边栏正常显示
- [ ] 显示 "对话历史" 标题
- [ ] 显示搜索框
- [ ] 如果有历史记录，显示对话列表
- [ ] 如果没有记录，显示 "暂无对话记录"

**截图位置**: `screenshots/test-1.1-conversation-list.png`

---

#### 1.2 搜索对话

**步骤**:
1. 在搜索框中输入关键词（例如："电子产品"）
2. 观察列表变化

**预期结果**:
- [ ] 列表实时过滤
- [ ] 只显示匹配的对话
- [ ] 如果没有匹配，显示 "未找到匹配的对话"

**截图位置**: `screenshots/test-1.2-search.png`

---

#### 1.3 选择对话

**步骤**:
1. 点击任意一条对话记录
2. 观察右侧详情区域

**预期结果**:
- [ ] 对话被高亮选中
- [ ] 右侧显示对话详情
- [ ] 显示产品名称、类别、趋势分数等信息

**截图位置**: `screenshots/test-1.3-select.png`

---

#### 1.4 删除对话

**步骤**:
1. 点击对话卡片右上角的垃圾桶图标
2. 在确认对话框中点击 "删除"

**预期结果**:
- [ ] 显示确认对话框
- [ ] 点击删除后，对话从列表中消失
- [ ] 显示成功提示

**截图位置**: `screenshots/test-1.4-delete.png`

---

### 测试 2: 图片上传和分析

#### 2.1 拖拽上传

**步骤**:
1. 访问 http://localhost:3000/phase2-demo
2. 点击 "图片分析" 标签
3. 准备一张产品图片（JPG/PNG，小于 10MB）
4. 拖拽图片到上传区域

**预期结果**:
- [ ] 拖拽时上传区域高亮
- [ ] 松开鼠标后开始上传
- [ ] 显示上传进度条
- [ ] 显示图片预览
- [ ] 显示 "分析中..." 提示

**截图位置**: `screenshots/test-2.1-drag-upload.png`

---

#### 2.2 点击上传

**步骤**:
1. 点击上传区域
2. 在文件选择器中选择图片
3. 点击 "打开"

**预期结果**:
- [ ] 打开文件选择器
- [ ] 只能选择图片文件
- [ ] 选择后开始上传
- [ ] 显示进度条和预览

**截图位置**: `screenshots/test-2.2-click-upload.png`

---

#### 2.3 分析结果

**步骤**:
1. 等待上传和分析完成（约 3-5 秒）
2. 查看右侧分析结果区域

**预期结果**:
- [ ] 显示 "图片分析完成！" 成功提示
- [ ] 右侧显示识别的产品类别
- [ ] 显示置信度分数
- [ ] 显示产品描述和标签
- [ ] 2 秒后自动清除预览

**截图位置**: `screenshots/test-2.3-analysis-result.png`

---

#### 2.4 错误处理

**步骤**:
1. 尝试上传非图片文件（例如 PDF）
2. 尝试上传超过 10MB 的图片

**预期结果**:
- [ ] 显示 "请上传图片文件" 错误提示
- [ ] 显示 "文件大小不能超过 10MB" 错误提示
- [ ] 不会开始上传

**截图位置**: `screenshots/test-2.4-error.png`

---

### 测试 3: 深色模式

#### 3.1 主题切换

**步骤**:
1. 访问 http://localhost:3000/phase2-demo
2. 点击右上角的主题切换按钮（太阳/月亮图标）
3. 选择 "Dark"（深色）
4. 选择 "Light"（浅色）
5. 选择 "System"（自动）

**预期结果**:
- [ ] 点击按钮显示下拉菜单
- [ ] 三个选项都可以点击
- [ ] 切换到深色模式后，整个页面变为深色
- [ ] 切换到浅色模式后，整个页面变为浅色
- [ ] 选择系统模式后，跟随系统设置
- [ ] 切换过程平滑，有过渡动画

**截图位置**: 
- `screenshots/test-3.1-light-mode.png`
- `screenshots/test-3.1-dark-mode.png`

---

#### 3.2 主题持久化

**步骤**:
1. 切换到深色模式
2. 刷新页面（F5 或 Cmd+R）
3. 观察主题是否保持

**预期结果**:
- [ ] 刷新后仍然是深色模式
- [ ] 没有闪烁或主题跳变

**截图位置**: `screenshots/test-3.2-persistence.png`

---

#### 3.3 所有组件适配

**步骤**:
1. 切换到深色模式
2. 访问所有标签页（概览、对话历史、图片分析、主题切换）
3. 检查所有组件的颜色

**预期结果**:
- [ ] 所有文本清晰可读
- [ ] 背景和前景色对比度足够
- [ ] 卡片、按钮、输入框都正确适配
- [ ] 没有白色闪烁或颜色错误

**截图位置**: `screenshots/test-3.3-components.png`

---

### 测试 4: 集成测试

#### 4.1 完整工作流

**步骤**:
1. 上传一张产品图片
2. 等待分析完成
3. 查看对话历史，确认新记录已保存
4. 切换到深色模式
5. 搜索刚才上传的产品
6. 删除该记录

**预期结果**:
- [ ] 所有步骤都正常工作
- [ ] 数据正确保存到 Directus
- [ ] 主题切换不影响功能
- [ ] 搜索能找到新记录
- [ ] 删除成功

**截图位置**: `screenshots/test-4.1-workflow.png`

---

#### 4.2 性能测试

**步骤**:
1. 打开浏览器开发者工具（F12）
2. 切换到 "Network" 标签
3. 刷新页面
4. 记录加载时间

**预期结果**:
- [ ] 页面加载时间 < 3 秒
- [ ] API 响应时间 < 1 秒
- [ ] 图片上传和分析 < 5 秒
- [ ] 主题切换 < 100ms

**截图位置**: `screenshots/test-4.2-performance.png`

---

#### 4.3 响应式设计

**步骤**:
1. 打开浏览器开发者工具（F12）
2. 切换到设备模拟器（Toggle device toolbar）
3. 测试以下设备：
   - iPhone 12 Pro (390x844)
   - iPad (768x1024)
   - Desktop (1920x1080)

**预期结果**:
- [ ] 移动端：侧边栏可能隐藏或折叠
- [ ] 平板：布局调整为单列或双列
- [ ] 桌面：完整的多列布局
- [ ] 所有元素可点击和交互
- [ ] 文本大小合适，不会溢出

**截图位置**: 
- `screenshots/test-4.3-mobile.png`
- `screenshots/test-4.3-tablet.png`
- `screenshots/test-4.3-desktop.png`

---

## 🐛 常见问题

### 问题 1: 无法连接到 Directus

**症状**: 对话历史显示 "加载中..." 但一直不显示数据

**解决方案**:
1. 检查 `.env.local` 中的 `NEXT_PUBLIC_DIRECTUS_URL` 是否正确
2. 检查网络连接
3. 打开浏览器控制台查看错误信息
4. 尝试直接访问 https://admin.cnsubscribe.xyz 确认服务可用

---

### 问题 2: 图片上传失败

**症状**: 上传后显示错误提示

**解决方案**:
1. 确认图片格式（JPG, PNG, GIF, WebP）
2. 确认图片大小 < 10MB
3. 检查 `.env.local` 中的 `NOVA_AI_API_KEY` 是否正确
4. 查看浏览器控制台的错误信息

---

### 问题 3: 主题切换不生效

**症状**: 点击主题切换按钮后页面没有变化

**解决方案**:
1. 清除浏览器缓存
2. 检查浏览器控制台是否有错误
3. 尝试硬刷新（Ctrl+Shift+R 或 Cmd+Shift+R）
4. 检查 localStorage 是否被禁用

---

### 问题 4: Token 过期

**症状**: 一段时间后 API 请求失败

**解决方案**:
1. Directus token 默认 15 分钟过期
2. 刷新页面重新获取 token
3. 或在代码中实现 token 自动刷新（未来优化）

---

## 📊 测试报告模板

### 测试环境

| 项目 | 信息 |
|------|------|
| 测试日期 | YYYY-MM-DD |
| 测试人员 | 您的名字 |
| 浏览器 | Chrome/Firefox/Safari 版本号 |
| 操作系统 | Windows/macOS/Linux |
| Node.js 版本 | v18.x.x |
| 项目版本 | Commit: d4db313 |

---

### 测试结果汇总

| 功能模块 | 测试用例数 | 通过 | 失败 | 通过率 |
|---------|-----------|------|------|--------|
| 对话历史记录 | 4 | _ | _ | _% |
| 图片上传分析 | 4 | _ | _ | _% |
| 深色模式 | 3 | _ | _ | _% |
| 集成测试 | 3 | _ | _ | _% |
| **总计** | **14** | **_** | **_** | **_%** |

---

### 详细测试记录

#### 测试 1.1: 查看对话列表

- **状态**: ✅ 通过 / ❌ 失败
- **实际结果**: 
- **问题描述**: （如果失败）
- **截图**: 

#### 测试 1.2: 搜索对话

- **状态**: ✅ 通过 / ❌ 失败
- **实际结果**: 
- **问题描述**: 
- **截图**: 

（继续填写其他测试用例...）

---

### 发现的问题

| 问题编号 | 严重程度 | 描述 | 重现步骤 | 截图 |
|---------|---------|------|---------|------|
| BUG-001 | 高/中/低 | 问题描述 | 1. 步骤1<br>2. 步骤2 | 链接 |

---

### 改进建议

1. **功能建议**:
   - 

2. **UI/UX 建议**:
   - 

3. **性能优化**:
   - 

---

### 测试结论

- [ ] 所有核心功能正常工作
- [ ] 发现 _ 个高优先级问题
- [ ] 发现 _ 个中优先级问题
- [ ] 发现 _ 个低优先级问题
- [ ] 建议进入生产环境 / 需要修复后再测试

---

## 📸 截图指南

### 如何截图

**Windows**: 
- Win + Shift + S（截图工具）
- 或使用 Snipping Tool

**macOS**: 
- Cmd + Shift + 4（区域截图）
- Cmd + Shift + 3（全屏截图）

**浏览器**:
- F12 打开开发者工具
- Ctrl/Cmd + Shift + P
- 输入 "screenshot"
- 选择 "Capture full size screenshot"

### 截图保存位置

建议在项目根目录创建 `screenshots` 文件夹：

```bash
mkdir -p demand-os/screenshots
```

---

## 🎯 快速测试（5分钟版本）

如果时间有限，请至少完成以下核心测试：

1. ✅ 访问 http://localhost:3000/phase2-demo
2. ✅ 切换到深色模式，确认正常
3. ✅ 上传一张图片，确认分析成功
4. ✅ 查看对话历史，确认有数据
5. ✅ 删除一条记录，确认成功

如果以上 5 项都通过，说明核心功能正常！

---

## 📞 支持

如果在测试过程中遇到问题：

1. 查看浏览器控制台错误信息
2. 查看 `demand-os/web/.next/` 目录下的日志
3. 检查环境变量配置
4. 参考 `PHASE2_COMPLETION_REPORT.md` 中的已知问题部分

---

**祝测试顺利！** 🚀
