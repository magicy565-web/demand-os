# 产业带坐标校准指南

## 问题描述

在SimpleMaps中国地图SVG (1000x738) 中，使用标准的经纬度到SVG坐标的线性映射公式无法准确定位产业带，导致标注点位置偏离实际地理位置。

## 解决方案

采用**手动校准表 (BELT_POSITION_FIXES)** 的方式，直接为每个产业带定义其在SVG中的准确百分比坐标。

## 校准表结构

```typescript
const BELT_POSITION_FIXES: Record<number, { x: number; y: number }> = {
  1: { x: 72.5, y: 62.0 },  // 产业带ID: { x百分比, y百分比 }
  2: { x: 78.5, y: 44.0 },
  // ...
};
```

## 产业带坐标参考

| ID | 产业带名称 | 地理坐标 | SVG坐标 (%) | 说明 |
|---|---|---|---|---|
| 1 | 深圳电子信息产业带 | 22.54°N, 114.06°E | x=72.5%, y=62.0% | 东南沿海 |
| 2 | 宁波模具与注塑产业带 | 29.87°N, 121.54°E | x=78.5%, y=44.0% | 浙江沿海 |
| 3 | 佛山泛家居产业带 | 23.02°N, 113.12°E | x=66.0%, y=67.0% | 珠三角 |
| 4 | 义乌小商品产业带 | 29.30°N, 120.08°E | x=68.5%, y=51.0% | 浙江中部 |
| 5 | 苏州纺织丝绸产业带 | 31.30°N, 120.59°E | x=73.0%, y=40.0% | 江苏沿海 |
| 6 | 广州番禺服装产业带 | 22.93°N, 113.38°E | x=70.0%, y=65.0% | 珠三角 |
| 7 | 永康五金工具产业带 | 28.90°N, 120.04°E | x=72.0%, y=56.0% | 浙江内陆 |
| 8 | 汕头澄海玩具产业带 | 23.46°N, 116.76°E | x=80.5%, y=68.5% | 粤东沿海 |

## 如何调整坐标

如果发现某个产业带的位置不准确，需要调整：

### 步骤1: 修改校准表

编辑 `web/src/components/industrial-map/ChinaIndustrialMap.tsx`：

```typescript
const BELT_POSITION_FIXES: Record<number, { x: number; y: number }> = {
  1: { x: 72.5, y: 62.0 },  // 修改这里的x、y值
  // ...
};
```

### 步骤2: 调整策略

- **向右移动**: 增加 x 值
- **向左移动**: 减少 x 值
- **向下移动**: 增加 y 值
- **向上移动**: 减少 y 值

### 步骤3: 验证效果

使用浏览器开发工具检查控制台输出，查看实际应用的坐标：

```
深圳电子信息产业带 (ID: 1): lat=22.5431, lng=114.0579 => x=72.50%, y=62.00%
```

## 为什么不用公式计算

SimpleMaps使用的SVG投影系统与标准Mercator投影存在差异，同时：
- 中国地图的省份边界线会影响视觉定位
- 滤镜效果会改变颜色对比度，影响感知位置
- 不同的缩放比例会导致坐标偏差

因此，手动校准表是最可靠的解决方案。

## 坐标系说明

- **SVG 原始坐标**: viewBox="0 0 1000 738"
- **使用百分比**: (x%, y%) 其中 0-100 对应 0-1000 或 0-738
- **原点**: 左上角 (0, 0)
- **X轴**: 从左到右增加
- **Y轴**: 从上到下增加

## 格式规范

校准坐标必须：
- 使用百分比格式 (0-100)
- 保留一位小数 (例: 72.5 而非 72 或 72.50)
- 按照ID顺序排列

## 备用方案: getBeltPosition 函数

```typescript
function getBeltPosition(beltId: number, lat: number, lng: number) {
  // 优先使用校准表
  if (BELT_POSITION_FIXES[beltId]) {
    return BELT_POSITION_FIXES[beltId];
  }
  
  // 备用: 使用公式推算（用于新增产业带）
  return latLngToSVGPercent(lat, lng);
}
```

这种设计保证了：
1. 现有8个产业带使用精准的手动校准坐标
2. 未来新增产业带可以使用公式作为初始值，然后微调

## 数据同步

校准表定义在两处：
1. **源码**: `web/src/components/industrial-map/ChinaIndustrialMap.tsx` (代码执行)
2. **配置**: `web/src/data/belt-position-calibration.json` (参考文档)

修改后请同时更新两处，保持数据一致。

## 常见问题

**Q: 为什么x值都在66-80之间？**
A: 因为所有产业带都位于中国东南沿海，这个地区在SVG中占据了x坐标的66-80%范围。

**Q: 为什么不直接使用SVG像素坐标？**
A: 因为React组件中使用百分比坐标更灵活，可以自适应不同的容器大小。

**Q: 如何添加新的产业带？**
A: 
1. 在 `industrial_belts.json` 中添加新记录 (ID=9)
2. 在 `BELT_POSITION_FIXES` 中添加校准坐标
3. 在 `belt-position-calibration.json` 中添加参考记录
