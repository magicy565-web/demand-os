# Demand-OS: 对话式工作流生成功能交付文档

**项目名称**: Demand-OS  
**功能模块**: 对话式工作流生成引擎  
**交付日期**: 2026-02-07  
**作者**: Manus AI

---

## 📋 交付概览

本次交付实现了 Demand-OS 的核心创新功能：**对话式工作流生成引擎**。这是一个对标 Accio 核心体验的功能，用户只需用自然语言描述需求，AI 就会自动将其解析并生成一个结构化的、可视化的工作流。

这标志着产品从"手动拖拽编辑"向"对话式智能生成"的重大转变，真正体现了 AI Agent 平台的智能化和易用性。

---

## 🎯 核心功能

### 1. 自然语言输入

用户在一个简洁的输入框中，用自然语言描述他们的需求。例如：

> "分析这个 TikTok 视频的爆款潜力，并匹配合适的工厂"

系统支持各种复杂的业务场景描述，包括：
- 海外寻源场景
- 工厂委托开发场景
- 产能分析场景
- 订单匹配场景
- 市场趋势分析场景

### 2. AI 智能解析

后端接收到用户的输入后，会构建一个精心设计的 Master Prompt，并将其发送给大语言模型 (GPT-4.1-mini)。

**Master Prompt 包含**:
- **角色定义**: 指示 AI 扮演一个工作流生成专家
- **节点库**: 详细列出可用的 6 种节点类型及其配置格式
- **输出格式**: 提供严格的 JSON Schema，确保输出格式正确
- **布局指导**: 指示 AI 将节点从左到右排列，间距合理

### 3. 自动生成工作流

AI 返回一个遵循 `AgentWorkflow` 结构的 JSON 对象，包含：
- **节点 (nodes)**: 每个节点都有类型、标签、配置和位置信息
- **连接 (edges)**: 定义节点之间的数据流向
- **元数据**: 工作流的名称、描述、类别等

### 4. 实时可视化展示

前端接收到 JSON 数据后，使用 `React Flow` 将其动态渲染为一个可视化的流程图。用户可以：
- 查看完整的工作流结构
- 了解每个节点的作用
- 看到数据的流动路径

---

## 📦 交付内容清单

### 1. 架构设计文档

| 文档名称 | 文件路径 | 说明 |
| :--- | :--- | :--- |
| 对话式工作流生成架构 | `CONVERSATIONAL_WORKFLOW_GENERATION_ARCHITECTURE.md` | 详细的架构设计、API 设计和 Prompt 工程 |

### 2. 后端 API

| 文件路径 | 功能描述 | 代码行数 |
| :--- | :--- | :---: |
| `web/src/app/api/agent/generate-from-text/route.ts` | 核心 API 端点，接收自然语言输入，调用 LLM，返回生成的工作流 JSON | 150 |

**API 端点**: `POST /api/agent/generate-from-text`

**请求体**:
```json
{
  "prompt": "分析这个 TikTok 视频的爆款潜力，并匹配合适的工厂",
  "sessionId": "user-session-12345" // 可选
}
```

**响应体**: 一个完整的 `AgentWorkflow` JSON 对象。

### 3. 前端页面

| 文件路径 | 功能描述 | 代码行数 |
| :--- | :--- | :---: |
| `web/src/app/chat-to-workflow/page.tsx` | 对话式工作流生成页面，包含输入框、生成按钮和可视化展示 | 200 |

**访问路径**: `http://localhost:3000/chat-to-workflow`

---

## 🚀 使用指南

### 1. 启动项目

```bash
cd /home/ubuntu/demand-os/web
pnpm install  # 如果是首次运行
pnpm dev
```

项目将在 `http://localhost:3000` 启动。

### 2. 访问对话式生成页面

在浏览器中打开: `http://localhost:3000/chat-to-workflow`

### 3. 输入需求并生成

1. 在输入框中输入您的需求描述，例如：
   > "分析这个 TikTok 视频的爆款潜力，并匹配合适的工厂"

2. 点击"生成工作流"按钮，或按 `Ctrl + Enter` 快捷键。

3. 等待 AI 生成（通常需要 5-15 秒）。

4. 生成成功后，页面下方将展示：
   - 工作流的名称、描述和类别
   - 节点数和连接数
   - 完整的可视化流程图

### 4. 使用示例需求

如果不确定如何描述需求，可以点击页面底部的"示例需求"按钮，快速填充一个预设的需求描述。

---

## 🎨 界面设计

### 页面布局

```
+------------------------------------------------------------------+
|                    对话式工作流生成                              |
|          用自然语言描述您的需求，AI 将自动为您生成专业的工作流    |
+------------------------------------------------------------------+
|                                                                  |
|  [描述您的需求]                                                  |
|  +------------------------------------------------------------+  |
|  | 请输入您的需求...                                          |  |
|  |                                                            |  |
|  |                                                            |  |
|  +------------------------------------------------------------+  |
|                                     [生成工作流] 按钮            |
+------------------------------------------------------------------+
|                                                                  |
|  [生成结果]                                                      |
|  +------------------------------------------------------------+  |
|  | 工作流名称: TikTok 爆款分析与工厂匹配                      |  |
|  | 描述: 根据用户提供的 TikTok 视频，分析其市场潜力...        |  |
|  | 类别: 海外寻源 | 节点数: 4 | 连接数: 3                     |  |
|  +------------------------------------------------------------+  |
|  |                                                            |  |
|  |            [可视化工作流图 - React Flow]                   |  |
|  |                                                            |  |
|  +------------------------------------------------------------+  |
+------------------------------------------------------------------+
```

### 设计特点

- **简洁的输入区**: 大而清晰的文本输入框，配有示例提示
- **即时反馈**: 生成过程中显示加载动画和状态提示
- **完整的结果展示**: 包含工作流的元数据和可视化图
- **快捷操作**: 支持 `Ctrl + Enter` 快速生成

---

## 🔧 技术实现细节

### 后端 Prompt 工程

这是整个系统的核心。我们设计了一个结构精巧的 Master Prompt，包含：

1. **角色定义**: 让 AI 扮演一个工作流生成专家
2. **节点库**: 详细列出 6 种节点类型及其配置格式
3. **输出格式**: 提供严格的 TypeScript 接口定义
4. **布局指导**: 指示 AI 将节点从左到右排列，间距 200px

**关键代码片段**:

```typescript
function buildMasterPrompt(userPrompt: string): string {
  return `# Role: AI Workflow Generation Expert

## Context:
You are an expert in building AI agent workflows...

## Available Node Types:
- **type**: \`input\`
  - **description**: The starting point of the workflow...
  
...

## User Request:
"${userPrompt}"

## Your JSON Output:`;
}
```

### 前端动态渲染

前端使用 `React Flow` 库将 AI 生成的 JSON 数据动态渲染为可视化的流程图。

**关键步骤**:
1. 调用 `/api/agent/generate-from-text` API
2. 解析返回的 JSON 数据
3. 使用 `WorkflowVisualizer` 组件渲染流程图
4. 自动调整视图 (`fitView`)，确保整个工作流可见

---

## 📊 技术栈

| 技术 | 版本 | 用途 |
| :--- | :--- | :--- |
| **Next.js** | 15.5.7 | React 框架 |
| **OpenAI SDK** | 4.77.3 | 调用大语言模型 |
| **React Flow** | 11.11.4 | 工作流可视化 |
| **Tailwind CSS** | 3.4.19 | 样式框架 |
| **shadcn/ui** | - | UI 组件库 |
| **Sonner** | 1.7.4 | Toast 通知 |

---

## 🎯 核心优势

### 1. 对标 Accio 的核心体验

Accio 的核心是"对话式搜索引擎"，用户通过自然语言与系统交互。我们的对话式工作流生成功能完全对标这一理念，让用户无需学习复杂的拖拽编辑，只需描述需求即可。

### 2. 降低使用门槛

传统的工作流编辑器需要用户理解节点类型、连接逻辑等技术细节。而对话式生成将这些复杂性隐藏在 AI 背后，让非技术用户也能轻松创建工作流。

### 3. 提高生产效率

手动搭建一个 4-6 个节点的工作流可能需要 5-10 分钟，而对话式生成只需 10-15 秒，效率提升了数十倍。

### 4. 适合政府和产业园区展示

在向政府和产业园区展示时，对话式生成能够直观地展示 AI 的智能化能力，给人留下深刻印象。演示者只需输入一个需求，系统就能自动生成一个完整的工作流，这种"魔法般"的体验远比手动拖拽更具说服力。

---

## 📈 后续优化方向

虽然我们已经实现了核心功能，但仍有一些方向可以进一步提升：

### 短期优化 (1-2 周)

- **多轮对话**: 支持用户对生成的工作流进行追问和修改，例如"把第二个节点改成查询海关数据"
- **保存和分享**: 允许用户保存生成的工作流，并分享给团队成员
- **执行集成**: 将生成的工作流直接连接到执行引擎，实现"生成即执行"

### 中期优化 (2-4 周)

- **历史记录**: 保存用户的生成历史，支持快速查看和复用
- **模板推荐**: 根据用户的输入，推荐相似的预置模板
- **可视化微调**: 在生成后，允许用户在画布上对工作流进行微调（拖动节点、修改配置等）

### 长期优化 (1-3 月)

- **多模态输入**: 支持用户上传图片、文件等，AI 根据这些内容生成工作流
- **工作流优化建议**: AI 分析生成的工作流，并提供优化建议（如合并冗余节点、优化执行顺序等）
- **协作生成**: 支持多人协作，共同完善一个工作流

---

## 🧪 测试建议

### 功能测试

1. **基础生成测试**: 输入简单的需求，验证能否生成合法的工作流
2. **复杂场景测试**: 输入复杂的、多步骤的需求，验证 AI 的理解能力
3. **边界测试**: 输入模糊的、不完整的需求，验证系统的容错能力
4. **性能测试**: 测试 API 的响应时间，确保在 15 秒内完成生成

### 用户体验测试

1. **易用性测试**: 邀请非技术用户尝试使用，收集反馈
2. **示例需求测试**: 验证示例需求是否能够成功生成
3. **错误处理测试**: 模拟 API 失败、网络错误等场景，验证错误提示是否友好

---

## 📝 GitHub 提交记录

- **仓库**: `magicy565-web/demand-os`
- **提交 ID**: `ad4a72d`
- **提交信息**: `feat: Implement conversational workflow generation - Add AI-powered natural language to workflow conversion`
- **分支**: `main`

---

## 🎉 总结

通过本次交付，Demand-OS 成功实现了对标 Accio 的核心功能：**对话式工作流生成**。这一功能将产品从一个"工具"升级为一个"智能助手"，真正体现了 AI Agent 平台的价值。

用户不再需要学习复杂的拖拽编辑，只需用自然语言描述需求，AI 就会自动生成一个专业的工作流。这种体验不仅降低了使用门槛，也大大提高了生产效率，非常适合在政府和产业园区进行展示。

我们期待这一功能能够为 Demand-OS 带来更多的用户认可和市场机会！

---

**交付完成时间**: 2026-02-07  
**下次更新**: 根据用户反馈进行迭代优化
