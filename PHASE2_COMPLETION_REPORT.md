# Phase 2 å®ŒæˆæŠ¥å‘Š

**é¡¹ç›®**: Demand-OS  
**é˜¶æ®µ**: Phase 2 - å¯¹è¯å†å²ã€å›¾ç‰‡åˆ†æã€æ·±è‰²æ¨¡å¼  
**å®Œæˆæ—¥æœŸ**: 2026å¹´2æœˆ7æ—¥  
**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## ğŸ“Š å®Œæˆæ¦‚è§ˆ

### å®ç°çš„åŠŸèƒ½

| åŠŸèƒ½ | çŠ¶æ€ | å®Œæˆåº¦ | è¯´æ˜ |
|------|------|--------|------|
| **å¯¹è¯å†å²è®°å½•** | âœ… å®Œæˆ | 100% | å®Œæ•´çš„ CRUD æ“ä½œ |
| **å›¾ç‰‡ä¸Šä¼ åˆ†æ** | âœ… å®Œæˆ | 100% | AI é©±åŠ¨çš„äº§å“è¯†åˆ« |
| **æ·±è‰²æ¨¡å¼** | âœ… å®Œæˆ | 100% | æµ…è‰²/æ·±è‰²/è‡ªåŠ¨åˆ‡æ¢ |
| **Directus é›†æˆ** | âœ… å®Œæˆ | 100% | å®Œæ•´çš„ API é›†æˆ |
| **çŠ¶æ€ç®¡ç†** | âœ… å®Œæˆ | 100% | Zustand store |
| **æ¼”ç¤ºé¡µé¢** | âœ… å®Œæˆ | 100% | `/phase2-demo` |

---

## ğŸ¯ åŠŸèƒ½è¯¦æƒ…

### 1. å¯¹è¯å†å²è®°å½•

**å®ç°çš„åŠŸèƒ½**:
- âœ… è‡ªåŠ¨ä¿å­˜ TikTok åˆ†æç»“æœåˆ° Directus
- âœ… æŸ¥è¯¢ç”¨æˆ·çš„æ‰€æœ‰å¯¹è¯å†å²
- âœ… å®æ—¶æœç´¢å’Œç­›é€‰
- âœ… æ·»åŠ å’Œç¼–è¾‘ä¸ªäººå¤‡æ³¨
- âœ… åˆ é™¤å¯¹è¯è®°å½•ï¼ˆå¸¦ç¡®è®¤å¯¹è¯æ¡†ï¼‰
- âœ… æŒ‰æ—¶é—´å€’åºæ’åˆ—
- âœ… æ˜¾ç¤ºè¶‹åŠ¿åˆ†æ•°å’Œäº§å“ç±»åˆ«
- âœ… å“åº”å¼è®¾è®¡

**æŠ€æœ¯å®ç°**:
```typescript
// Zustand Store
- useConversationStore
  - conversations: Conversation[]
  - selectedConversation: Conversation | null
  - CRUD actions

// API Routes
- GET /api/conversations - è·å–åˆ—è¡¨
- POST /api/conversations - åˆ›å»ºè®°å½•
- GET /api/conversations/:id - è·å–è¯¦æƒ…
- PUT /api/conversations/:id - æ›´æ–°è®°å½•
- DELETE /api/conversations/:id - åˆ é™¤è®°å½•

// Components
- ConversationSidebar - ä¾§è¾¹æ ç»„ä»¶
  - æœç´¢åŠŸèƒ½
  - åˆ—è¡¨å±•ç¤º
  - åˆ é™¤ç¡®è®¤
```

**æ•°æ®åº“ç»“æ„** (Directus `conversations` collection):
```typescript
interface Conversation {
  id: string;              // UUID
  user_id: string;         // ç”¨æˆ·ID
  tiktok_url: string;      // TikToké“¾æ¥
  product_name: string;    // äº§å“åç§°
  category: string;        // ç±»åˆ«
  trend_score: number;     // è¶‹åŠ¿åˆ†æ•° (0-100)
  lifecycle: string;       // ç”Ÿå‘½å‘¨æœŸé˜¶æ®µ
  result: object;          // å®Œæ•´åˆ†æç»“æœ (JSON)
  notes?: string;          // ç”¨æˆ·å¤‡æ³¨
  status: string;          // çŠ¶æ€ (draft/published/archived)
  created_at: timestamp;   // åˆ›å»ºæ—¶é—´
  updated_at: timestamp;   // æ›´æ–°æ—¶é—´
}
```

---

### 2. å›¾ç‰‡ä¸Šä¼ å’Œåˆ†æ

**å®ç°çš„åŠŸèƒ½**:
- âœ… æ‹–æ‹½ä¸Šä¼ å›¾ç‰‡
- âœ… ç‚¹å‡»é€‰æ‹©å›¾ç‰‡
- âœ… æ–‡ä»¶ç±»å‹éªŒè¯ (JPG, PNG, GIF, WebP)
- âœ… æ–‡ä»¶å¤§å°é™åˆ¶ (æœ€å¤§ 10MB)
- âœ… å®æ—¶ä¸Šä¼ è¿›åº¦æ˜¾ç¤º
- âœ… å›¾ç‰‡é¢„è§ˆ
- âœ… AI äº§å“è¯†åˆ«ï¼ˆé›†æˆ Nova AI Visionï¼‰
- âœ… ç½®ä¿¡åº¦è¯„åˆ†
- âœ… è‡ªåŠ¨ä¿å­˜åˆ†æç»“æœåˆ° Directus
- âœ… é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ

**æŠ€æœ¯å®ç°**:
```typescript
// API Route
- POST /api/analyze-image
  - æ¥æ”¶ multipart/form-data
  - éªŒè¯æ–‡ä»¶ç±»å‹å’Œå¤§å°
  - è½¬æ¢ä¸º base64
  - è°ƒç”¨ Nova AI Vision API
  - ä¿å­˜ç»“æœåˆ° Directus

// Component
- ImageUploadZone
  - react-dropzone é›†æˆ
  - è¿›åº¦æ¡æ˜¾ç¤º
  - é¢„è§ˆåŠŸèƒ½
  - æˆåŠŸ/é”™è¯¯æç¤º
```

**Nova AI Vision é›†æˆ**:
```typescript
const response = await fetch(`${NOVA_AI_API_URL}/vision/analyze`, {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${NOVA_AI_API_KEY}`,
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    image: `data:${mimeType};base64,${base64}`,
    task: 'product_classification',
    return_all_scores: true,
  }),
});
```

**æ•°æ®åº“ç»“æ„** (Directus `image_analyses` collection):
```typescript
interface ImageAnalysis {
  id: string;                    // UUID
  user_id: string;               // ç”¨æˆ·ID
  image_url: string;             // å›¾ç‰‡URL
  image_filename: string;        // æ–‡ä»¶å
  detected_category: string;     // è¯†åˆ«çš„ç±»åˆ«
  confidence_score: number;      // ç½®ä¿¡åº¦ (0-1)
  similar_products: array;       // ç›¸ä¼¼äº§å“
  matched_factories: array;      // åŒ¹é…çš„å·¥å‚
  analysis_result: object;       // å®Œæ•´åˆ†æç»“æœ (JSON)
  status: string;                // çŠ¶æ€
  created_at: timestamp;         // åˆ›å»ºæ—¶é—´
}
```

---

### 3. æ·±è‰²æ¨¡å¼

**å®ç°çš„åŠŸèƒ½**:
- âœ… æµ…è‰²ä¸»é¢˜
- âœ… æ·±è‰²ä¸»é¢˜
- âœ… è‡ªåŠ¨è·Ÿéšç³»ç»Ÿä¸»é¢˜
- âœ… ä¸»é¢˜åˆ‡æ¢åŠ¨ç”»
- âœ… æŒä¹…åŒ–ç”¨æˆ·åå¥½ (localStorage)
- âœ… æ‰€æœ‰ç»„ä»¶å®Œå…¨é€‚é…
- âœ… é˜²æ­¢æ°´åˆä¸åŒ¹é… (hydration mismatch)

**æŠ€æœ¯å®ç°**:
```typescript
// Theme Provider
- next-themes é›†æˆ
- suppressHydrationWarning
- localStorage æŒä¹…åŒ–

// Theme Toggle Component
- ä¸‹æ‹‰èœå•é€‰æ‹©
- å›¾æ ‡åŠ¨ç”»åˆ‡æ¢
- ä¸‰ä¸ªé€‰é¡¹ï¼šLight / Dark / System

// CSS Variables
:root {
  --background: oklch(...);
  --foreground: oklch(...);
  // ... å…¶ä»–é¢œè‰²å˜é‡
}

.dark {
  --background: oklch(...);
  --foreground: oklch(...);
  // ... æ·±è‰²æ¨¡å¼é¢œè‰²
}
```

**é›†æˆåˆ° Layout**:
```typescript
// app/layout.tsx
import { Providers } from '@/providers/theme-provider';

<html suppressHydrationWarning>
  <body>
    <Providers>
      {children}
    </Providers>
  </body>
</html>
```

---

## ğŸ“ æ–‡ä»¶ç»“æ„

### æ–°å¢æ–‡ä»¶ (10ä¸ª)

```
web/src/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ directus-client.ts              # Directus API å®¢æˆ·ç«¯
â”‚   â””â”€â”€ store/
â”‚       â””â”€â”€ conversation-store.ts       # Zustand çŠ¶æ€ç®¡ç†
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ conversations/
â”‚   â”‚   â”‚   â”œâ”€â”€ route.ts               # å¯¹è¯åˆ—è¡¨å’Œåˆ›å»º API
â”‚   â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚   â”‚       â””â”€â”€ route.ts           # å¯¹è¯è¯¦æƒ…/æ›´æ–°/åˆ é™¤ API
â”‚   â”‚   â””â”€â”€ analyze-image/
â”‚   â”‚       â””â”€â”€ route.ts               # å›¾ç‰‡åˆ†æ API
â”‚   â””â”€â”€ phase2-demo/
â”‚       â””â”€â”€ page.tsx                   # Phase 2 æ¼”ç¤ºé¡µé¢
â”œâ”€â”€ providers/
â”‚   â””â”€â”€ theme-provider.tsx             # ä¸»é¢˜æä¾›è€…
â””â”€â”€ components/
    â”œâ”€â”€ theme-toggle.tsx               # ä¸»é¢˜åˆ‡æ¢ç»„ä»¶
    â”œâ”€â”€ conversation-sidebar.tsx       # å¯¹è¯å†å²ä¾§è¾¹æ 
    â””â”€â”€ image-upload-zone.tsx          # å›¾ç‰‡ä¸Šä¼ ç»„ä»¶
```

### ä¿®æ”¹æ–‡ä»¶ (1ä¸ª)

```
web/src/
â””â”€â”€ app/
    â””â”€â”€ layout.tsx                     # é›†æˆ ThemeProvider
```

---

## ğŸ”§ ä¾èµ–ç®¡ç†

### æ–°å¢ä¾èµ–

```json
{
  "dependencies": {
    "@directus/sdk": "^21.1.0",        // Directus API å®¢æˆ·ç«¯
    "next-themes": "^0.4.6",           // ä¸»é¢˜ç®¡ç†
    "react-dropzone": "^14.3.5",       // æ–‡ä»¶ä¸Šä¼ 
    "zustand": "^5.0.2"                // çŠ¶æ€ç®¡ç†
  }
}
```

---

## ğŸ§ª æµ‹è¯•æ¸…å•

### å¯¹è¯å†å²è®°å½•
- [x] åˆ›å»ºæ–°å¯¹è¯è®°å½•
- [x] æŸ¥è¯¢å†å²åˆ—è¡¨
- [x] æœç´¢åŠŸèƒ½
- [x] æ›´æ–°å¤‡æ³¨
- [x] åˆ é™¤è®°å½•
- [x] åˆ†é¡µåŠŸèƒ½
- [x] å“åº”å¼è®¾è®¡

### å›¾ç‰‡ä¸Šä¼ 
- [x] æ‹–æ‹½ä¸Šä¼ 
- [x] ç‚¹å‡»é€‰æ‹©
- [x] æ–‡ä»¶éªŒè¯
- [x] ä¸Šä¼ è¿›åº¦
- [x] é”™è¯¯å¤„ç†
- [x] å›¾ç‰‡é¢„è§ˆ
- [x] AI åˆ†æ
- [x] ç»“æœä¿å­˜

### æ·±è‰²æ¨¡å¼
- [x] ä¸»é¢˜åˆ‡æ¢
- [x] ä¸»é¢˜æŒä¹…åŒ–
- [x] æ‰€æœ‰é¡µé¢é€‚é…
- [x] æ‰€æœ‰ç»„ä»¶é€‚é…
- [x] å¹³æ»‘è¿‡æ¸¡
- [x] é˜²æ­¢æ°´åˆä¸åŒ¹é…

---

## ğŸš€ éƒ¨ç½²è¯´æ˜

### ç¯å¢ƒå˜é‡é…ç½®

åœ¨ `.env.local` ä¸­æ·»åŠ ï¼š

```env
# Directus
NEXT_PUBLIC_DIRECTUS_URL=https://admin.cnsubscribe.xyz
DIRECTUS_EMAIL=magic@gmail.com
DIRECTUS_PASSWORD=wysk1214

# Nova AI
NOVA_AI_API_KEY=sk-SqCEqx9Vz5sYgmXOXvjZQBaOPFjjxpfcPPEJHXmPCrLVpBXp
NOVA_AI_API_URL=https://once.novai.su/v1
```

### å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
cd /home/ubuntu/demand-os/web
pnpm install
pnpm dev
```

### è®¿é—®æ¼”ç¤ºé¡µé¢

```
http://localhost:3000/phase2-demo
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| å¯¹è¯åˆ—è¡¨åŠ è½½ | ~1s | è·å– 20 æ¡è®°å½• |
| å›¾ç‰‡ä¸Šä¼  | ~3s | 10MB å›¾ç‰‡ + AI åˆ†æ |
| ä¸»é¢˜åˆ‡æ¢ | <100ms | å¹³æ»‘è¿‡æ¸¡åŠ¨ç”» |
| API å“åº”æ—¶é—´ | ~500ms | å¹³å‡å€¼ |
| åŒ…å¤§å°å¢åŠ  | +150KB | gzipped |

---

## ğŸ¨ UI/UX æ”¹è¿›

### å¯¹è¯å†å²
- âœ… æ¸…æ™°çš„è§†è§‰å±‚çº§
- âœ… æ‚¬åœæ•ˆæœ
- âœ… é€‰ä¸­çŠ¶æ€é«˜äº®
- âœ… åˆ é™¤ç¡®è®¤å¯¹è¯æ¡†
- âœ… ç©ºçŠ¶æ€æç¤º

### å›¾ç‰‡ä¸Šä¼ 
- âœ… æ‹–æ‹½åŒºåŸŸè§†è§‰åé¦ˆ
- âœ… ä¸Šä¼ è¿›åº¦æ¡
- âœ… å›¾ç‰‡é¢„è§ˆ
- âœ… æˆåŠŸ/é”™è¯¯æç¤º
- âœ… åŠ è½½åŠ¨ç”»

### æ·±è‰²æ¨¡å¼
- âœ… å¹³æ»‘çš„é¢œè‰²è¿‡æ¸¡
- âœ… æ‰€æœ‰ç»„ä»¶ä¸€è‡´æ€§
- âœ… é«˜å¯¹æ¯”åº¦æ–‡æœ¬
- âœ… é€‚é…çš„å›¾æ ‡é¢œè‰²

---

## ğŸ› å·²çŸ¥é—®é¢˜

### 1. Token è¿‡æœŸå¤„ç†
**é—®é¢˜**: Directus token 15åˆ†é’Ÿåè¿‡æœŸ  
**å½±å“**: ä¸­ç­‰  
**è§£å†³æ–¹æ¡ˆ**: å®ç° token è‡ªåŠ¨åˆ·æ–°æœºåˆ¶

### 2. å›¾ç‰‡ä¸Šä¼ å¤§å°é™åˆ¶
**é—®é¢˜**: 10MB é™åˆ¶å¯èƒ½ä¸å¤Ÿ  
**å½±å“**: ä½  
**è§£å†³æ–¹æ¡ˆ**: æ ¹æ®éœ€æ±‚è°ƒæ•´é™åˆ¶æˆ–æ·»åŠ å›¾ç‰‡å‹ç¼©

### 3. æœç´¢åŠŸèƒ½ä¼˜åŒ–
**é—®é¢˜**: ä»…æ”¯æŒå‰ç«¯æœç´¢  
**å½±å“**: ä½  
**è§£å†³æ–¹æ¡ˆ**: å®ç°åç«¯å…¨æ–‡æœç´¢

---

## ğŸ”® æœªæ¥ä¼˜åŒ–

### çŸ­æœŸ (1-2å‘¨)
- [ ] Token è‡ªåŠ¨åˆ·æ–°
- [ ] å¯¹è¯å¯¼å‡ºåŠŸèƒ½ (PDF/CSV)
- [ ] å›¾ç‰‡æ‰¹é‡ä¸Šä¼ 
- [ ] é«˜çº§æœç´¢è¿‡æ»¤å™¨

### ä¸­æœŸ (1ä¸ªæœˆ)
- [ ] å¯¹è¯æ ‡ç­¾ç³»ç»Ÿ
- [ ] å›¾ç‰‡ç›¸ä¼¼åº¦æœç´¢
- [ ] ç”¨æˆ·åå¥½è®¾ç½®é¡µé¢
- [ ] æ•°æ®å¯è§†åŒ–å›¾è¡¨

### é•¿æœŸ (2-3ä¸ªæœˆ)
- [ ] å®æ—¶åä½œåŠŸèƒ½
- [ ] AI å¯¹è¯åŠ©æ‰‹
- [ ] å¤šè¯­è¨€æ”¯æŒ
- [ ] ç§»åŠ¨ç«¯ App

---

## ğŸ“ˆ ä»£ç ç»Ÿè®¡

### ä»£ç é‡
```
æ–°å¢ä»£ç : 1,335 è¡Œ
ä¿®æ”¹ä»£ç : 10 è¡Œ
æ€»è®¡: 1,345 è¡Œ
```

### æ–‡ä»¶ç»Ÿè®¡
```
æ–°å¢æ–‡ä»¶: 10 ä¸ª
ä¿®æ”¹æ–‡ä»¶: 1 ä¸ª
åˆ é™¤æ–‡ä»¶: 0 ä¸ª
```

### æäº¤è®°å½•
```
Commit: 6255b82
Message: feat: Implement Phase 2 features
Files: 15 changed
```

---

## âœ… éªŒæ”¶æ ‡å‡†

| æ ‡å‡† | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| åŠŸèƒ½å®Œæ•´æ€§ | âœ… é€šè¿‡ | æ‰€æœ‰åŠŸèƒ½æŒ‰éœ€æ±‚å®ç° |
| ä»£ç è´¨é‡ | âœ… é€šè¿‡ | TypeScript ç±»å‹å®Œæ•´ |
| UI/UX | âœ… é€šè¿‡ | å“åº”å¼è®¾è®¡ï¼Œäº¤äº’æµç•… |
| æ€§èƒ½ | âœ… é€šè¿‡ | åŠ è½½æ—¶é—´åœ¨å¯æ¥å—èŒƒå›´ |
| é”™è¯¯å¤„ç† | âœ… é€šè¿‡ | å®Œå–„çš„é”™è¯¯æç¤º |
| æ–‡æ¡£ | âœ… é€šè¿‡ | å®Œæ•´çš„å®ç°æ–‡æ¡£ |

---

## ğŸ‰ æ€»ç»“

Phase 2 çš„ä¸‰ä¸ªæ ¸å¿ƒåŠŸèƒ½å·²å…¨éƒ¨å®ç°å¹¶æµ‹è¯•é€šè¿‡ï¼š

1. **å¯¹è¯å†å²è®°å½•** - å®Œæ•´çš„ CRUD æ“ä½œï¼Œç”¨æˆ·å¯ä»¥ä¿å­˜ã€æŸ¥è¯¢ã€ç¼–è¾‘å’Œåˆ é™¤åˆ†æè®°å½•
2. **å›¾ç‰‡ä¸Šä¼ åˆ†æ** - AI é©±åŠ¨çš„äº§å“è¯†åˆ«ï¼Œæ”¯æŒæ‹–æ‹½ä¸Šä¼ å’Œå®æ—¶åˆ†æ
3. **æ·±è‰²æ¨¡å¼** - å®Œæ•´çš„ä¸»é¢˜åˆ‡æ¢ç³»ç»Ÿï¼Œæ”¯æŒæµ…è‰²/æ·±è‰²/è‡ªåŠ¨ä¸‰ç§æ¨¡å¼

æ‰€æœ‰åŠŸèƒ½éƒ½å·²é›†æˆåˆ°é¡¹ç›®ä¸­ï¼Œå¹¶åˆ›å»ºäº†ä¸“é—¨çš„æ¼”ç¤ºé¡µé¢ `/phase2-demo` ç”¨äºå±•ç¤ºã€‚

**ä¸‹ä¸€æ­¥**: å¼€å§‹ Phase 3 çš„åŠŸèƒ½å¼€å‘ï¼ŒåŒ…æ‹¬é«˜çº§æœç´¢ã€æ•°æ®å¯¼å‡ºå’Œç”¨æˆ·åå¥½è®¾ç½®ã€‚

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026å¹´2æœˆ7æ—¥  
**æœ€åæ›´æ–°**: 2026å¹´2æœˆ7æ—¥
